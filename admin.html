<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>采访记录后台</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="admin-page">
    <div class="admin-wrapper">
        <div class="admin-main">
            <header class="admin-header admin-header-tabs">
                <div class="admin-tabs-bar">
                    <div class="admin-tabs">
                        <button class="admin-tab is-active" data-target="admin-tips">提示</button>
                        <button class="admin-tab" data-target="admin-data">数据</button>
                        <button class="admin-tab" data-target="admin-stats">统计</button>
                        <button class="admin-tab" data-target="admin-editor">修改</button>
                        <button class="admin-tab" data-target="admin-ai">AI</button>
                        <button class="admin-tab" data-target="admin-flow">流程</button>
                    </div>
                    <div class="admin-actions">
                        <button id="admin-refresh" class="btn btn-secondary">刷新</button>
                        <button id="admin-export" class="btn btn-secondary">导出</button>
                        <button id="admin-clear" class="btn btn-secondary">清空</button>
                    </div>
                </div>
            </header>
            <section id="admin-tips" class="admin-section is-active">
                <div class="admin-tips">
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">版本分配</div>
                        <p>填写姓名并开始后，系统会在后台随机分配“含 AI / 不含 AI”版本（50% 概率），页面不显示分配结果。</p>
                    </div>
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">含 AI 版本</div>
                        <p>助手启用追问与采访功能，AI 回复会记录到后台，并计入 AI 互动次数。</p>
                    </div>
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">不含 AI 版本</div>
                        <p>助手不显示 AI 交互按钮；每个有选项的页面有 80% 概率提供固定提示语，并记录到数据里。</p>
                    </div>
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">测试入口</div>
                        <p>姓名输入 AI 强制进入含 AI 版本；输入 NORMAL 强制进入不含 AI 版本。后台“含 AI”列显示为红色标记。</p>
                    </div>
                </div>
            </section>
            <section id="admin-data" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">数据说明</div>
                    <p>用时为从开始到结局的总时长（秒）。点击次数与移动距离记录用户输入行为。选择记录按流程顺序展示，如有 AI 对话会显示在对应选择下方。热图基于结局时的页面截图与点击分布叠加。</p>
                </div>
                <main class="admin-content">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>姓名</th>
                                <th>含 AI</th>
                                <th>用时（秒）</th>
                                <th>点击次数</th>
                                <th>移动距离（px）</th>
                                <th>AI 互动次数</th>
                                <th>选择记录</th>
                                <th>热图</th>
                                <th>管理</th>
                                <th>完成时间</th>
                            </tr>
                        </thead>
                        <tbody id="admin-rows"></tbody>
                    </table>
                </main>
            </section>
            <section id="admin-stats" class="admin-section">
                <div class="admin-stats">
                    <div class="admin-stats-group">
                        <div class="admin-stats-title">当日完成数</div>
                        <div class="admin-stats-row">AI：<span id="stats-today-ai">0</span></div>
                        <div class="admin-stats-row">非 AI：<span id="stats-today-nonai">0</span></div>
                        <div class="admin-stats-row">总计：<span id="stats-today-total">0</span></div>
                    </div>
                    <div class="admin-stats-group">
                        <div class="admin-stats-title">总共完成数</div>
                        <div class="admin-stats-row">AI：<span id="stats-total-ai">0</span></div>
                        <div class="admin-stats-row">非 AI：<span id="stats-total-nonai">0</span></div>
                        <div class="admin-stats-row">总计：<span id="stats-total-total">0</span></div>
                    </div>
                    <div class="admin-stats-group">
                        <div class="admin-stats-title">平均完成时间</div>
                        <div class="admin-stats-row"><span id="stats-avg-duration">0</span> 秒</div>
                    </div>
                </div>
                <div class="admin-chart">
                    <div class="admin-chart-title">完成数分布</div>
                    <div class="admin-chart-bars">
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">AI</div>
                            <div class="admin-chart-track">
                                <div id="chart-bar-ai" class="admin-chart-fill"></div>
                            </div>
                            <div id="chart-value-ai" class="admin-chart-value">0</div>
                        </div>
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">非 AI</div>
                            <div class="admin-chart-track">
                                <div id="chart-bar-nonai" class="admin-chart-fill"></div>
                            </div>
                            <div id="chart-value-nonai" class="admin-chart-value">0</div>
                        </div>
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">总计</div>
                            <div class="admin-chart-track">
                                <div id="chart-bar-total" class="admin-chart-fill"></div>
                            </div>
                            <div id="chart-value-total" class="admin-chart-value">0</div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="admin-editor" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">修改语言</div>
                    <p>修改面板仅编辑中文，保存时会自动补齐英文内容；未配置 AI 时将直接复制原文。</p>
                    <div class="admin-section-note-title">修改范围</div>
                    <p>修改页面仅支持调整“标题、正文、选项文案”，并提示每个选项通向的页面；不支持改动图片或分支结构。</p>
                </div>
                <div class="admin-editor">
                    <div class="admin-editor-card">
                        <div class="admin-editor-title">页面内容</div>
                        <div class="admin-editor-row">
                            <label for="editor-scene-select">页面</label>
                            <select id="editor-scene-select" class="admin-editor-select"></select>
                        </div>
                        <div class="admin-editor-row" data-lang="zh">
                            <label for="editor-title-zh">标题（中文）</label>
                            <input id="editor-title-zh" class="admin-editor-input" type="text" data-lang="zh" />
                        </div>
                        <div class="admin-editor-row" data-lang="en">
                            <label for="editor-title-en">标题（英文）</label>
                            <input id="editor-title-en" class="admin-editor-input" type="text" data-lang="en" />
                        </div>
                        <div class="admin-editor-row" data-lang="zh">
                            <label for="editor-text-zh">正文（中文）</label>
                            <textarea id="editor-text-zh" class="admin-editor-textarea" rows="3" data-lang="zh"></textarea>
                        </div>
                        <div class="admin-editor-row" data-lang="en">
                            <label for="editor-text-en">正文（英文）</label>
                            <textarea id="editor-text-en" class="admin-editor-textarea" rows="3" data-lang="en"></textarea>
                        </div>
                        <div class="admin-editor-row admin-editor-row-multi">
                            <label>选项</label>
                            <div class="admin-editor-choices">
                                <div id="editor-choices"></div>
                            </div>
                        </div>
                        <div class="admin-editor-actions">
                            <button id="editor-save-scene" class="btn btn-primary" type="button">保存页面</button>
                            <button id="editor-reset-scene" class="btn btn-secondary" type="button">还原默认</button>
                            <span id="editor-save-feedback" class="admin-editor-feedback" aria-live="polite"></span>
                        </div>
                    </div>

                </div>
            </section>
            <section id="admin-ai" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">AI 背景</div>
                    <p>AI 页面可修改整体背景与角色背景（中文），系统会自动同步英文内容。</p>
                </div>
                <div class="admin-editor">
                    <div class="admin-editor-card">
                        <div class="admin-editor-title">AI 背景</div>
                        <div class="admin-editor-row">
                            <label for="ai-background-zh">背景（中文）</label>
                            <textarea id="ai-background-zh" class="admin-editor-textarea" rows="5"></textarea>
                        </div>
                        <div class="admin-editor-actions">
                            <button id="ai-background-save" class="btn btn-primary" type="button">保存背景</button>
                            <span id="ai-background-feedback" class="admin-editor-feedback" aria-live="polite"></span>
                        </div>
                    </div>
                    <div class="admin-editor-card">
                        <div class="admin-editor-title">采访角色背景</div>
                        <div id="ai-role-backgrounds" class="admin-editor-roles"></div>
                        <div class="admin-editor-actions">
                            <button id="ai-role-save" class="btn btn-primary" type="button">保存角色背景</button>
                            <span id="ai-role-feedback" class="admin-editor-feedback" aria-live="polite"></span>
                        </div>
                    </div>
                </div>
            </section>
            <section id="admin-flow" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">流程页面</div>
                    <p>流程页以树状流程图展示全部页面、选项去向与结局标题，便于检查剧情连线。</p>
                </div>
                <div class="admin-flow">
                    <div class="admin-flow-title">剧情流程图</div>
                    <div id="admin-flowchart" class="admin-flowchart"></div>
                </div>
            </section>
        </div>
    </div>
    <script type="module" src="js/admin.js"></script>
</body>
</html>
