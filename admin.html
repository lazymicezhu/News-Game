<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>采访记录后台</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="admin-page">
    <div class="admin-wrapper">
        <div class="admin-main">
            <header class="admin-header admin-header-tabs">
                <div class="admin-tabs-bar">
                    <div class="admin-tabs">
                        <button class="admin-tab is-active" data-target="admin-tips">提示</button>
                        <button class="admin-tab" data-target="admin-data">数据</button>
                        <button class="admin-tab" data-target="admin-stats">统计</button>
                        <button class="admin-tab" data-target="admin-editor">修改</button>
                        <button class="admin-tab" data-target="admin-ai">AI</button>
                        <button class="admin-tab" data-target="admin-flow">流程</button>
                        <button class="admin-tab" data-target="admin-config">配置</button>
                    </div>
                    <div class="admin-actions">
                        <button id="admin-refresh" class="btn btn-secondary">刷新</button>
                        <button id="admin-export" class="btn btn-secondary">导出</button>
                        <button id="admin-clear" class="btn btn-secondary">清空</button>
                    </div>
                </div>
            </header>
            <section id="admin-tips" class="admin-section is-active">
                <div class="admin-tips">
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">版本分配</div>
                        <p>填写姓名并开始后，系统会在后台随机分配“含 AI / 不含 AI”版本（50% 概率），页面不显示分配结果。</p>
                    </div>
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">含 AI 版本</div>
                        <p>助手启用追问与采访功能。AI 回复会记录到后台，并计入 AI 互动次数。</p>
                    </div>
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">不含 AI 版本</div>
                        <p>助手不显示 AI 交互按钮；每个有选项的页面有 80% 概率出现固定提示语，并记录到数据里。</p>
                    </div>
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">测试入口</div>
                        <p class="admin-note-danger">
                            姓名输入 <span class="admin-inline-code">AI</span> 强制进入含 AI 版本；
                            输入 <span class="admin-inline-code">NORMAL</span> 强制进入不含 AI 版本。
                            后台“含 AI”列显示为红色标记。
                        </p>
                    </div>
                    <div class="admin-sidebar-section">
                        <div class="admin-sidebar-heading">流程说明</div>
                        <p>当前为线性流程（10-15 个页面），每页 3 个开放选项。新闻价值初始 60 分，选项会加减分；最终 90 分及以上为好结局，低于 90 为坏结局。</p>
                    </div>
                </div>
            </section>
            <section id="admin-data" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">数据说明</div>
                    <p>姓名后括号为本局新闻价值得分，姓名旁标签显示“含 AI/非 AI”与“了解/不了解”。用时为从开始到结局的总时长（秒）。行为汇总包含点击次数、移动距离与 AI 互动次数。选择记录按流程顺序展示，如有 AI 对话或非 AI 提示会显示在对应选择下方。热图基于结局时的页面截图与点击分布叠加。备注可手动填写。</p>
                </div>
                <main class="admin-content">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>序号</th>
                                <th>姓名</th>
                                <th>用时/完成</th>
                                <th>行为</th>
                                <th>选择记录</th>
                                <th>点击热图</th>
                                <th>管理</th>
                                <th>备注</th>
                            </tr>
                        </thead>
                        <tbody id="admin-rows"></tbody>
                    </table>
                </main>
            </section>
            <section id="admin-stats" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">统计说明</div>
                    <p>统计基于本地记录数据，包含当日与累计完成数、平均完成时间，以及 AI/非 AI 的平均新闻价值得分与分布图表。</p>
                </div>
                <div class="admin-stats">
                    <div class="admin-stats-group">
                        <div class="admin-stats-title">当日完成数</div>
                        <div class="admin-stats-row">AI：<span id="stats-today-ai">0</span></div>
                        <div class="admin-stats-row">非 AI：<span id="stats-today-nonai">0</span></div>
                        <div class="admin-stats-row">总计：<span id="stats-today-total">0</span></div>
                    </div>
                    <div class="admin-stats-group">
                        <div class="admin-stats-title">总共完成数</div>
                        <div class="admin-stats-row">AI：<span id="stats-total-ai">0</span></div>
                        <div class="admin-stats-row">非 AI：<span id="stats-total-nonai">0</span></div>
                        <div class="admin-stats-row">总计：<span id="stats-total-total">0</span></div>
                    </div>
                    <div class="admin-stats-group">
                        <div class="admin-stats-title">平均完成时间</div>
                        <div class="admin-stats-row"><span id="stats-avg-duration">0</span> 秒</div>
                    </div>
                    <div class="admin-stats-group">
                        <div class="admin-stats-title">平均新闻价值</div>
                        <div class="admin-stats-row">AI：<span id="stats-score-ai">0</span></div>
                        <div class="admin-stats-row">非 AI：<span id="stats-score-nonai">0</span></div>
                    </div>
                </div>
                <div class="admin-chart">
                    <div class="admin-chart-title">完成数分布</div>
                    <div class="admin-chart-bars">
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">AI</div>
                            <div class="admin-chart-track">
                                <div id="chart-bar-ai" class="admin-chart-fill"></div>
                            </div>
                            <div id="chart-value-ai" class="admin-chart-value">0</div>
                        </div>
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">非 AI</div>
                            <div class="admin-chart-track">
                                <div id="chart-bar-nonai" class="admin-chart-fill"></div>
                            </div>
                            <div id="chart-value-nonai" class="admin-chart-value">0</div>
                        </div>
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">总计</div>
                            <div class="admin-chart-track">
                                <div id="chart-bar-total" class="admin-chart-fill"></div>
                            </div>
                            <div id="chart-value-total" class="admin-chart-value">0</div>
                        </div>
                    </div>
                </div>
                <div class="admin-chart">
                    <div class="admin-chart-title">新闻价值均值</div>
                    <div class="admin-chart-bars">
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">AI</div>
                            <div class="admin-chart-track">
                                <div id="score-bar-ai" class="admin-chart-fill"></div>
                            </div>
                            <div id="score-value-ai" class="admin-chart-value">0</div>
                        </div>
                        <div class="admin-chart-bar">
                            <div class="admin-chart-label">非 AI</div>
                            <div class="admin-chart-track">
                                <div id="score-bar-nonai" class="admin-chart-fill"></div>
                            </div>
                            <div id="score-value-nonai" class="admin-chart-value">0</div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="admin-editor" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">修改语言</div>
                    <p>修改面板仅编辑中文，保存时会自动补齐英文内容；未配置 AI 时将直接复制原文。</p>
                    <div class="admin-section-note-title">修改范围</div>
                    <p>仅支持调整“标题、正文、选项文案”。选项下方提示通向的页面标题，分支走向与新闻价值加减不在此处修改。</p>
                    <div class="admin-section-note-title">研究指向</div>
                    <p>剧情与选项围绕“可信度判断与情绪反应”设计，强调证据冲突与不确定性呈现。选项主要在“核实优先/叙事优先/时效优先”之间拉开差异，用于观察玩家在 AI 介入下对可信度与情绪的取舍。</p>
                </div>
                <div class="admin-editor">
                    <div class="admin-editor-card">
                        <div class="admin-editor-title">页面内容</div>
                        <div class="admin-editor-row">
                            <label for="editor-scene-select">页面</label>
                            <select id="editor-scene-select" class="admin-editor-select"></select>
                        </div>
                        <div class="admin-editor-row" data-lang="zh">
                            <label for="editor-title-zh">标题</label>
                            <input id="editor-title-zh" class="admin-editor-input" type="text" data-lang="zh" />
                        </div>
                        <div class="admin-editor-row" data-lang="en">
                            <label for="editor-title-en">标题（英文）</label>
                            <input id="editor-title-en" class="admin-editor-input" type="text" data-lang="en" />
                        </div>
                        <div class="admin-editor-row" data-lang="zh">
                            <label for="editor-text-zh">正文</label>
                            <textarea id="editor-text-zh" class="admin-editor-textarea" rows="3" data-lang="zh"></textarea>
                        </div>
                        <div class="admin-editor-row" data-lang="en">
                            <label for="editor-text-en">正文（英文）</label>
                            <textarea id="editor-text-en" class="admin-editor-textarea" rows="3" data-lang="en"></textarea>
                        </div>
                        <div class="admin-editor-row admin-editor-row-multi">
                            <label>选项</label>
                            <div class="admin-editor-choices">
                                <div id="editor-choices"></div>
                            </div>
                        </div>
                        <div class="admin-editor-actions">
                            <button id="editor-save-scene" class="btn btn-primary" type="button">保存页面</button>
                            <button id="editor-reset-scene" class="btn btn-secondary" type="button">还原默认</button>
                            <span id="editor-save-feedback" class="admin-editor-feedback" aria-live="polite"></span>
                        </div>
                    </div>

                </div>
            </section>
            <section id="admin-ai" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">AI 背景</div>
                    <p>AI 页面可修改整体背景、角色背景与提示词（中文），系统会自动同步英文内容。</p>
                    <p>调用模型读取 config/ai.json（默认 gpt-4o-mini），游戏内使用流式回复。</p>
                    <p>调用结构：追问 = system(追问提示词) + user(整体背景 + 追问问题)；采访 = system(角色名 + 采访提示词) + user(角色背景 + 采访问题)。</p>
                </div>
                <div class="admin-editor">
                    <div class="admin-editor-card">
                        <div class="admin-editor-title">AI 提示词</div>
                        <div class="admin-editor-row">
                            <label for="ai-followup-prompt-zh">追问提示词</label>
                            <textarea id="ai-followup-prompt-zh" class="admin-editor-textarea" rows="4"></textarea>
                        </div>
                        <div class="admin-editor-row">
                            <label for="ai-interview-prompt-zh">采访提示词</label>
                            <textarea id="ai-interview-prompt-zh" class="admin-editor-textarea" rows="4"></textarea>
                        </div>
                        <div class="admin-editor-actions">
                            <button id="ai-prompts-save" class="btn btn-primary" type="button">保存提示词</button>
                            <span id="ai-prompts-feedback" class="admin-editor-feedback" aria-live="polite"></span>
                        </div>
                    </div>
                    <div class="admin-editor-card">
                        <div class="admin-editor-title">AI 背景</div>
                        <div class="admin-editor-row">
                            <label for="ai-background-zh">背景（中文）</label>
                            <textarea id="ai-background-zh" class="admin-editor-textarea" rows="5"></textarea>
                        </div>
                        <div class="admin-editor-actions">
                            <button id="ai-background-save" class="btn btn-primary" type="button">保存背景</button>
                            <span id="ai-background-feedback" class="admin-editor-feedback" aria-live="polite"></span>
                        </div>
                    </div>
                    <div class="admin-editor-card">
                        <div class="admin-editor-title">采访角色背景</div>
                        <div id="ai-role-backgrounds" class="admin-editor-roles"></div>
                        <div class="admin-editor-actions">
                            <button id="ai-role-save" class="btn btn-primary" type="button">保存角色背景</button>
                            <span id="ai-role-feedback" class="admin-editor-feedback" aria-live="polite"></span>
                        </div>
                    </div>
                </div>
            </section>
            <section id="admin-flow" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">流程页面</div>
                    <p>流程页以树状流程图展示页面顺序与结局走向，当前为线性流程，结局分为好结局与坏结局。</p>
                </div>
                <div class="admin-flow">
                    <div class="admin-flow-title">剧情流程图</div>
                    <div id="admin-flowchart" class="admin-flowchart"></div>
                </div>
            </section>
            <section id="admin-config" class="admin-section">
                <div class="admin-section-note">
                    <div class="admin-section-note-title">配置导入导出</div>
                    <p>导出内容包含全部页面配置与 AI 配置（整体背景、角色背景、提示词）。导入会覆盖本地配置并立即生效，适合跨设备传递修改结果。</p>
                    <div class="admin-section-actions">
                        <button id="admin-config-export" class="btn btn-secondary" type="button">导出配置</button>
                        <button id="admin-config-import" class="btn btn-secondary" type="button">导入配置</button>
                        <input id="admin-config-file" type="file" accept="application/json" hidden />
                    </div>
                </div>
            </section>
        </div>
    </div>
    <div id="admin-save-overlay" class="admin-loading-overlay" aria-live="polite" aria-busy="true">
        <div class="admin-loading-card">
            <div class="admin-loading-title">正在保存...</div>
            <div class="admin-loading-sub">保存会进行 AI 翻译处理，请稍候。</div>
            <div class="admin-loading-sub">修改后请导出配置给 Lazymice 写入代码；本站无后端，数据不会跨设备同步。</div>
        </div>
    </div>
    <script type="module" src="js/admin.js"></script>
</body>
</html>
